<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bloxfruit Gacha</title>
  <style>
   #auth-form {
     width: 265px;
     margin: 2;
     background: #222;
     padding: 20px;
     border-radius: 10px;
     text-align: center;
     box-shadow: 0 0 10px rgba(0,0,0,0.5);
   }
    
    #auth-form input,
    #auth-form button {
     width: 100%;
     padding: 10px;
     margin: 8px 0;
     box-sizing: border-box;
   }

    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
   }

    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    #coin-display {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 1rem;
      font-size: 1.25rem;
    }

    #coin-display img {
      width: 32px;
      height: 32px;
      margin-right: 8px;
    }

    #toggle-backpack {
      background: none;
      border: none;
      cursor: pointer;
      padding: 10px;
    }

    #gacha-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      height: 120px;
      margin: 2rem auto;
      overflow: hidden;
      border: 3px solid #fff;
      background: #222;
    }

    #roller {
      display: flex;
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
    }

    .item {
      width: 120px;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid;
      box-sizing: border-box;
    }

    .Common { border-color: gray; }
    .Uncommon { border-color: skyblue; }
    .Rare { border-color: #8C4DFF; }
    .Legend { border-color: #C23BFF; }
    .Myth { border-color : crimson; }

    #line {
      position: absolute;
      top: 0;
      left: 50%;
      width: 2px;
      height: 100%;
      background: red;
      transform: translateX(-1px);
      z-index: 10;
    }

    #result {
      margin-top: 2rem;
      font-size: 1.5rem;
    }

    button {
      padding: 1rem 2rem;
      font-size: 1rem;
      background: limegreen;
      border: none;
      color: black;
      cursor: pointer;
      font-weight: bold;
      margin: 1rem;
    }
  
   #tombolProfil {
     position: absolute;
     top: 55px;     /* Geser dari atas */
     left: 315px;    /* Geser dari kiri */
     background: white;
     border-radius: 5px;
     padding:0px ;
   }

    #tombolProfil img {
      width: 40px;
      height: 40px;
      display: block;
    }

    #backpack-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      z-index: 1000;
      padding: 2rem;
      overflow: auto;
    }

    .backpack-item {
      display: inline-block; 
      margin: 10px;    /*  Fruit  */
      border: 3px solid transparent;
      padding: 5px;
      cursor: pointer;
    }

   .backpack-item.Common { border-color: gray; }
    .backpack-item.Uncommon { border-color: skyblue; }
    .backpack-item.rare { border-color: #8C4DFF; }
    .backpack-item.legend { border-color: #C23BFF; }
    .backpack-item.myth { border-color: crimson; }

    .fade {
      animation: fadeInOut 3s ease-in-out;
    }

    @keyframes fadeInOut {
      0% { opacity: 1; }
      90% { opacity: 0.8; }
      100% { opacity: 0; }
    }

    .backpack-slot {
      margin: 10px;
      padding: 10px;
      border: 2px solid white;
      text-align: center;
      width: 100px;
    }

    .backpack-slot img {
      width: 64px;
      height: 64px;
    }

   .sell-btn {
      background: red;
      border: none;
      color: white;
      margin-top: 5px;
      cursor: pointer;
    }

   #profilePopup {
     position: fixed;
     top: 0; left: 0; right: 0; bottom: 0;
     background: rgba(0, 0, 0, 0.5);
     display: none;
     justify-content: center;
     align-items: center;
     transition: opacity 0.3s ease;
   }

   #profilePopup[style*="display: block"] {
     display: flex !important;
     opacity: 1;
   }

   #profilePopup > div {
     background: #1e1e1e;
     color: white;
     padding: 20px;
     border-radius: 8px;
     width: 300px;
     box-shadow: 0 0 15px rgba(0,0,0,0.4);
   }

   input[type="text"],
   input[type="password"],
   input[type="file"] {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
  background: #2a2a2a;
  color: white;
  border: 1px solid #444;
  border-radius: 4px;
}

   #currentProfilePic {
     width: 100%;
     height: auto;
     max-width: 100px;
     max-height: 100px;
     object-fit: cover;
     display: block;
     margin: 10px auto;
     border-radius: 50%;
     box-shadow: 0 0 10px rgba(0,0,0,0.3);
   }

   .profile-btn {
     width: 100%;
     padding: 10px;
     margin-top: 8px;
     background-color: #4CAF50;
     color: white;
     border: none;
     border-radius: 4px;
     cursor: pointer;
     transition: 0.3s;
   }

   .profile-btn:hover {
     background-color: #45a049;
    }

    #chatButton {
     position: fixed;
     top: 660px;
     left: px;
     border: 500px;
     border-radius: 110px;
     background: black;
     bottom: 20px;
     right: 20px;
     width: 60px;
     height: 60px;
     cursor: pointer;
     z-index: 998;
   }

/* Style untuk Popup */
   #chatPopup {
     position: fixed;
     bottom: 100px; /* Ganti posisi bottom untuk menghindari keyboard */
     right: 20px;
     width: 90%;
     max-width: 350px;
     max-height: 400px;
     background-color: white;
     padding: 15px;
     border-radius: 10px;
     box-shadow: 0 0 10px rgba(0,0,0,0.2);
     display: none;
     flex-direction: column;
     z-index: 999;
   }

/* Style untuk Pesan Chat */
   #chatMessages {
     max-height: 300px;
     overflow-y: auto;
     margin-bottom: 10px;
     color: black; /* Warna teks pesan chat */
   }

/* Pesan chat */
   #chatMessages div {
     margin-bottom: 10px;
     padding: 8px;
     background-color: #f1f1f1; /* Latar belakang pesan */
     border-radius: 5px;
     font-size: 14px;
}

/* Style Input Pesan */
   #chatInput {
     width: calc(100% - 20px);
     padding: 10px;
     font-size: 14px;
     border-radius: 5px;
     border: 1px solid #ccc;
   }

   #sendBtn {
     background-color: #4CAF50;
     color: white;
     border: none;
     padding: 8px;
     width: 100%;
     cursor: pointer;
     font-weight: bold;
   }

   .quest-popup {
     display: none;
     position: fixed;
     left: 0;
     top: 0;
     width: 100%;
     height: 100%;
     background: rgba(0,0,0,0.4);
     justify-content: center;
     align-items: center;
     z-index: 9;
   }

   .quest-popup-content {
     background: white;
     padding: 20px;
     border-radius: 12px;
     width: 80%;
     max-width: 300px;
     text-align: center;
     position: relative;
     overflow: visible !important;
   }

   .quest-title {
     font-size: 20px;
     margin-bottom: 10px;
     font-weight: bold;
   }

   .quest-text {
     display: block;
     color: black;
     font-size: 16px;
   }

   #claimBtn:disabled {
     background-color: gray;
     cursor: not-allowed;
     color: white;
   }
  </style>
</head>
<body>
  <div id="auth-form">
    <h3 id="auth-title">Login</h3>
    <input type="text" id="username" placeholder="Username" required />
    <input type="password" id="password" placeholder="Password" required />
    <button onclick="login()">Login</button>
    <button onclick="register()">Daftar</button>
    </div>  <!-- Konten Game Gacha (disembunyikan sebelum login) -->  <div id="game-content" style="display: none;">
  <!-- Header with Coin Display and Backpack Button -->
  <div id="header">
    <div id="coin-display">
      <img src="assets/Robux.png" alt="coin">
      <span id="coins">1</span> Coins
    </div>
    <button id="toggle-backpack" title="Open Backpack">
      <img src="assets/backpack.png" alt="Backpack" width="50" height="50" />
    </button>
  </div>

  <!-- Modal Backpack -->
  <div id="backpack-modal">
    <h2>Backpack</h2>
    <div id="backpack-items" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
    <button onclick="document.getElementById('backpack-modal').style.display='none'">Tutup</button>
  </div>

  <!-- Gacha Container and Button -->
  <div id="gacha-container">
    <div id="line"></div>
    <div id="roller"></div>
  </div>
  <button onclick="roll()">Buka Gacha (1 Coin)</button>

  <!-- Result Area -->
  <div id="result"></div>  

  <!-- Backpack Items Section -->
  <div id="backpack"></div>

  <!-- Sound Effect -->
  <audio id="sound" src="assets/gacha-sounf.mp3"></audio>
  
  <!-- Tombol Trade -->
<button id="trade-button" style="position: absolute; top: 10px; left: 10px;">TRADE</button>

<div id="trade-popup" style="display: none; position: fixed; top: 10%; left: 20%; width: 60%; background: black; color: white; padding: 20px; border: 2px solid white; overflow-y: auto; max-height: 80vh; z-index: 1000;">
  <!-- Pair 1 -->
  <div class="trade-pair" data-give="RocketFruit.png" data-get="BladeFruit.png" style="margin-bottom: 40px; text-align: center;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
      <img src="assets/RocketFruit.png" width="60">
      <div style="font-size: 24px;">⇄</div>
      <img src="assets/BladeFruit.png" width="60">
    </div>
    <br>
    <button class="accept-btn">ACCEPT</button>
  </div>

  <!-- Pair 2 -->
  <div class="trade-pair" data-give="SpikeFruit.png" data-get="SpringFruit.png" style="margin-bottom: 40px; text-align: center;">
    <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
      <img src="assets/SpikeFruit.png" width="60">
      <div style="font-size: 24px;">⇄</div>
      <img src="assets/SpringFruit.png" width="60">
    </div>
    <br>
    <button class="accept-btn">ACCEPT</button>
  </div>

  <!-- Tambahkan pasangan lain di sini dengan format yang sama -->
</div>

<button id="tombolProfil" onclick="openProfile()">
  <img src="assets/settings.png" alt="." />
</button>

<!-- Popup Profil -->
<div id="profilePopup" style="display:none;">
  <div>
    <h2 style="text-align:center;">Edit Profil</h2>

    <label for="editUsername">Username:</label>
    <input type="text" id="editUsername" disabled />

    <label for="editPassword">Password:</label>
    <input type="password" id="editPassword" />

    <label>Profile Picture:</label>
    <img id="currentProfilePic" src="assets/RocketFruit.png" width="100" height="100" alt="Profile Picture">
    <input type="file" id="profilePicInput" accept="image/*" onchange="uploadProfilePic(event)" />

    <button class="profile-btn" onclick="saveProfile()">Simpan Profil</button>
<button class="profile-btn" onclick="closeProfile()">Tutup</button>
  </div>
</div>

<!-- Tombol Chat -->
<img id="chatButton" src="assets/chat.png" alt="Chat" />

<!-- Popup Chat -->
  <div id="chatPopup">
    <div id="chatHeader">Global Chat</div>
    <div id="chatMessages"></div>
    <input id="chatInput" type="text" placeholder="Ketik pesan..." />
    <button onclick="sendMessage()">Kirim</button>
  </div>
  
<!-- Tombol PNG -->
<img src="assets/quest.png" id="questButton" style="position: fixed; top: 20px; left: 328px; width: 50px; cursor: pointer; z-index: 10; border-radius: 80px;">

<!-- Popup Quest -->
<div id="questPopup" class="quest-popup">
  <div class="quest-popup-content">
    <h2 class="quest-title">Quest</h2>
    <p class="quest-text">Chat DiGlobal Chat 1x</p>
    <button id="claimBtn" disabled>Claim</button>
    <p class="quest-text">Claim Gratis Tiap 5 Menit</p>
<button id="claim5minBtn" disabled style="opacity: 0.5;">Next in: 1:00</button>
<span id="coinDisplay">0</span> <!-- Ini buat nampilin coin -->
  </div>
</div>

  <script>
    let coins = 1;
let coinsPerSpin = 1;
    let currentUser = null;

    const users = JSON.parse(localStorage.getItem("gacha-users") || "{}");

    function saveUsers() {
      localStorage.setItem("gacha-users", JSON.stringify(users));
    }

    function login() {
      const u = username.value;
      const p = password.value;
      if (!users[u]) {
        alert("Akun tidak ditemukan!");
      } else if (users[u].password !== p) {
        alert("Password salah!");
      } else {
        currentUser = u;
        coins = users[u].coins;
        document.getElementById("auth-form").style.display = "none";
        document.getElementById("game-content").style.display = "block";
        renderBackpack();
        updateCoins();
      }
    }

    function register() {
      const u = username.value;
      const p = password.value;
      if (users[u]) {
        alert("Username sudah digunakan!");
      } else {
        users[u] = { password: p, coins: 1, backpack: [] };
        saveUsers();
        alert("Pendaftaran berhasil! Silakan login.");
      }
    }

    function updateCoins() {
  document.getElementById("coins").textContent = coins; // update isi <span id="coins">
  users[currentUser].coins = coins;
  saveUsers();
}

    function addToBackpack(item) {
      const div = document.createElement("div");
      div.className = `backpack-item ${item.rarity}`;
      div.title = `Klik untuk jual: ${item.name}`;
      div.innerHTML = `<img src="${item.image}" width="50" height="50">`;
      div.onclick = () => {}; 
      backpack.appendChild(div);
      users[currentUser].backpack.push(item);
      saveUsers();
    }

    function renderBackpack() {
      backpack.innerHTML = "";
      users[currentUser].backpack.forEach(addToBackpack);
    }
    
    const items = [
      { name: "Rocket [Common]", image: "RocketFruit.png", rarity: "Common" },
      { name: "Spin [Common]", image: "SpinFruit.png", rarity: "Common" },
      { name: "Blade [Common]", image: "BladeFruit.png", rarity: "Common" },
      { name: "Spring [Common]", image: "SpringFruit.png", rarity: "Common" },
      { name: "Bomb [Common]", image: "BombFruit.png", rarity: "Common" },
      { name: "Smoke [Common]", image: "SmokeFruit.png", rarity: "Common" },
      { name: "Spike [Common]", image: "SpikeFruit.png", rarity: "Common" },
      { name: "Flame [Uncommon]", image: "FlameFruit.png", rarity: "Uncommon" },
      { name: "Ice [Uncommon]", image: "IceFruit.png", rarity: "Uncommon" },
      { name: "Sand [Uncommon]", image: "SandFruit.png", rarity: "Uncommon" },
      { name: "Dark [Uncommon]", image: "DarkFruit.png", rarity: "Uncommon" },
      { name: "Eagle [Uncommon]", image: "EagleFruit.png", rarity: "Uncommon" },
      { name: "Diamond [Uncommon]", image: "DiamondFruit.png", rarity: "Uncommon" },
    ];

    const roller = document.getElementById("roller");
    const result = document.getElementById("result");
    const sound = document.getElementById("sound");
    const coinDisplay = document.getElementById("coins");
    const backpack = document.getElementById("backpack");

    function updateCoins() {
      coinDisplay.textContent = coins;
    }

    function roll() {
      if (coins < coinsPerSpin) {
  result.textContent = `Butuh ${coinsPerSpin} koin untuk spin!`;
  return;
}
coins -= coinsPerSpin;
      updateCoins();

      result.textContent = "";
      roller.innerHTML = "";
      const gachaItems = [];
      for (let i = 0; i < 30; i++) {
        const item = items[Math.floor(Math.random() * items.length)];
        gachaItems.push(item);
      }

      gachaItems.forEach((item) => {
        const div = document.createElement("div");
        div.className = `item ${item.rarity}`;
        div.innerHTML = `<img src="${item.image}" width="80" height="80">`;
        roller.appendChild(div);
      });

      const middleIndex = 14;
      const offset = middleIndex * 120 - (document.getElementById("gacha-container").offsetWidth / 2 - 6);

      roller.style.transition = "none";
      roller.style.transform = `translateX(0px)`;
      void roller.offsetWidth;
      roller.style.transition = "transform 3s cubic-bezier(0.1, 0.7, 0.1, 1)";
      roller.style.transform = `translateX(-${offset}px)`;

      sound.currentTime = 0;
      sound.play();

      setTimeout(() => {
        const selected = gachaItems[middleIndex];
        result.innerHTML = `Kamu dapat: <strong style="color:${getColor(selected.rarity)}">${selected.name}</strong>`;
        addToBackpack(selected);
      }, 3100);
    }

    function addToBackpack(item) {
      const div = document.createElement("div");
      div.className = `backpack-item ${item.rarity}`;
      div.title = `Klik untuk jual: ${item.name}`;
      div.innerHTML = `<img src="${item.image}" width="50" height="50">`;
      
      // Menghapus fitur langsung jual saat klik item
      div.onclick = () => {}; // tidak melakukan apa-apa saat diklik
      
      backpack.appendChild(div);
    }

    function getColor(rarity) {
      return {
        Common: "gray",
        Uncommon: "skyblue",
        Rare: "#8C4DFF",
        Legend: "#C23BFF",
        Myth: "crimson"
      }[rarity];
    }

    function getSellValue(rarity) {
      return {
        Common: 1,
        Uncommon: 2,
        epic: 3,
        myth: 5
      }[rarity] || 1;
    }

    updateCoins();
    document.getElementById("trade-button").addEventListener("click", () => {
  document.getElementById("trade-popup").style.display = "block";
  updateAcceptButtons();
});

function updateAcceptButtons() {
  document.querySelectorAll(".trade-pair").forEach(pair => {
    const give = pair.getAttribute("data-give");
    const btn = pair.querySelector(".accept-btn");

    const hasItem = Array.from(document.querySelectorAll("#backpack .backpack-item img"))
      .some(img => img.src.includes(give));

    if (hasItem) {
      btn.disabled = false;
      btn.style.opacity = 1;
    } else {
      btn.disabled = true;
      btn.style.opacity = 0.5;
    }
  });
}

document.querySelectorAll(".trade-pair .accept-btn").forEach(btn => {
  btn.addEventListener("click", function () {
    const pair = this.closest(".trade-pair");
    const give = pair.getAttribute("data-give");
    const get = pair.getAttribute("data-get");

    const items = document.querySelectorAll("#backpack .backpack-item");
    let removed = false;

    items.forEach(item => {
      const img = item.querySelector("img");
      if (!removed && img.src.includes(give)) {
        item.remove();
        removed = true;

        const newItem = document.createElement("div");
        newItem.className = "backpack-item Common";
        newItem.innerHTML = `<img src="${get}" />`;
        document.getElementById("backpack").appendChild(newItem);
      }
    });

    renderBackpack();
    updateAcceptButtons();
  });
});

document.getElementById("trade-popup").addEventListener("click", e => {
  if (e.target.id === "trade-popup") {
    document.getElementById("trade-popup").style.display = "none";
  }
});
    

    document.getElementById("toggle-backpack").onclick = () => {
      document.getElementById("backpack-modal").style.display = "block"; // Tampilkan modal
      renderBackpack();
    };

    function renderBackpack() {
      const container = document.getElementById("backpack-items");
      container.innerHTML = "";

      backpack.querySelectorAll(".backpack-item").forEach((el, index) => {
        const rarity = Array.from(el.classList).find(c => ["Common", "Uncommon", "epic", "myth"].includes(c));
        const imgSrc = el.querySelector("img").src;
        const slot = document.createElement("div");
        slot.className = "backpack-slot";
        slot.innerHTML = `
          <img src="${imgSrc}" />
          <div>Rarity: <span style="color:${getColor(rarity)}">${rarity}</span></div>
          <button class="sell-btn">Sell (+${getSellValue(rarity)} coins)</button>
        `;
        slot.querySelector("button").onclick = () => {
          coins += getSellValue(rarity);
          updateCoins();
          el.remove();
          slot.remove();
        };
        container.appendChild(slot);
      });
    }
    
    function openProfile() {
  document.getElementById("profilePopup").style.display = "block";
  const editUsername = document.getElementById("editUsername");
  editUsername.value = currentUser;
}

function closeProfile() {
  document.getElementById("profilePopup").style.display = "none";
}

function saveProfile() {
  const newPassword = document.getElementById("editPassword").value;
  if (newPassword) {
    users[currentUser].password = newPassword;
    saveUsers();
    alert("Profil berhasil disimpan!");
  }
}

function uploadProfilePic(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onloadend = function() {
    document.getElementById("currentProfilePic").src = reader.result;
  };
  if (file) {
    reader.readAsDataURL(file);
  }
}

function saveProfile() {
  const newUsername = document.getElementById("editUsername").value;
  const newPassword = document.getElementById("editPassword").value;

  if (!newPassword) {
    alert("Password tidak boleh kosong.");
    return;
  }

  if (newUsername !== currentUser) {
    if (users[newUsername]) {
      alert("Username sudah dipakai!");
      return;
    }
    users[newUsername] = { ...users[currentUser], password: newPassword };
    delete users[currentUser];
    currentUser = newUsername;
  } else {
    users[currentUser].password = newPassword;
  }

  saveUsers();
  alert("Profil disimpan.");
  closeProfile();
}

const chatPopup = document.getElementById("chatPopup");
const chatButton = document.getElementById("chatButton");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");

chatButton.onclick = () => {
  chatPopup.style.display = chatPopup.style.display === "flex" ? "none" : "flex";
};

let hasChatted = false;

const questButton = document.getElementById("questButton");
const questPopup = document.getElementById("questPopup");
const claimBtn = document.getElementById("claimBtn");

questButton.onclick = () => {
  questPopup.style.display = questPopup.style.display === "flex" ? "none" : "flex";
};

claimBtn.onclick = () => {
  if (hasChatted && !claimBtn.disabled) {
    coins += 1;
    updateCoins();
    claimBtn.disabled = true;
    alert("Kamu mendapat 1 coin!");
  }
};

// Hook ke fungsi global chat
function sendMessage() {
  const text = chatInput.value.trim();
  if (text === "") return;

  const msg = document.createElement("div");
  const time = new Date().toLocaleTimeString();
  msg.innerHTML = `<strong>${currentUser}</strong> [${time}]: ${text}`;
  chatMessages.appendChild(msg);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  chatInput.value = "";

  // Quest: Cek apakah sudah pernah chat
  if (!hasChatted) {
    hasChatted = true;
    claimBtn.disabled = false;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const claim5minBtn = document.getElementById("claim5minBtn");

  if (!claim5minBtn) return;

  let countdown = 6;
  let timer = null;

  function updateCountdown() {
    if (countdown <= 0) {
      clearInterval(timer);
      claim5minBtn.disabled = false;
      claim5minBtn.style.opacity = 1;
      claim5minBtn.textContent = "Claim 1 Menit";
    } else {
      const min = Math.floor(countdown / 6);
      const sec = countdown % 6;
      claim5minBtn.textContent = `Next in: ${min}:${sec.toString().padStart(2, '0')}`;
      claim5minBtn.disabled = true;
      claim5minBtn.style.opacity = 0.5;
      countdown--;
    }
  }

  function startTimer() {
    updateCountdown();
    timer = setInterval(updateCountdown, 1000);
  }

  claim5minBtn.onclick = () => {
    if (countdown <= 0 && currentUser && users[currentUser]) {
      coins += 200;
      updateCoins(); // ini akan update tampilan dan simpan ke localStorage
      alert("Kamu mendapat 2 coin dari quest 1 menit!");
      countdown = 6;
      startTimer();
    }
  };

  startTimer();
});

  </script>
</body>
</html>
